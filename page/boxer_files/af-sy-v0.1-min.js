var jsScriptUrlParams=getParamsFromScriptTag("af-sy-v0.1-min.js"),valid_period=jsScriptUrlParams.valid_period,parts=location.hostname.split("."),domain=parts[parts.length-2]+"."+parts[parts.length-1],tag=getUrlVars().aftag;function getUrlVars(){var r={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,t,n){r[t]=n});return r}function _af_getCookie(e){if(0!=document.cookie.length)for(var t=new RegExp("(; )","g"),n=document.cookie.split(t),r=0;r<n.length;r++){var a=new RegExp("=","g"),a=n[r].split(a);if(a[0]==e)return unescape(a[1])}return null}function _af_setcookie(e,t,n,r){var a;n=n?((a=new Date).setTime(a.getTime()+24*n*60*60*1e3),"; expires="+a.toGMTString()):"",document.cookie=e+"="+t+n+"; domain="+domain+"; path=/"}function getParamsFromScriptTag(e){for(var t=document.getElementsByTagName("script"),n=0;n<t.length;n++)if(-1<t[n].src.indexOf("/"+e)){for(var r=t[n].src.split("?").pop().split("&"),a={},o=0;o<r.length;o++){var i=r[o].split("=");a[i[0]]=i[1]}return a}return{}}function getOrderIdFromPage(){var e=document.getElementsByClassName("os-order-number"),t=null;return t=1==e.length?e[0].innerHTML.replace("Order #","").replace("Commande #","").trim():t}null!=tag&&_af_setcookie("_af",tag,valid_period,"_af");var timerCount=0;function getShopifyCheckout(e){timerCount++;var t,n=Shopify.checkout,r=_af_getCookie("_af"),a={},o=[];r&&(-1!==(t=(t=null)==e?getOrderIdFromPage():e).indexOf("Â°")&&(t=t.replace(/[^a-z0-9 ]/gi,"")),a={script_version:"af-2021-12-10",transaction_amount:n.subtotal_price,transaction_currency:n.presentment_currency,click_hash:r,created_at:n.created_at,checkout_id:n.order_id,transaction_order_id:t,timerCount:timerCount},n.line_items.forEach(function(e){e.title=e.title.replace("&"," - "),e.title=e.title.replace("&"," - ");e={transaction_detail_item_sku:e.sku,transaction_detail_item_name:e.title,transaction_detail_item_amount:e.price,transaction_detail_item_quantity:e.quantity};o.push(e)}),e=JSON.stringify({transaction:a,transaction_detail:o}),(r=new XMLHttpRequest).onreadystatechange=function(){},r.open("POST","https://icq.affiliationfocus.com/client/transaction/"),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.send("data="+e),null==t&&1==timerCount?(console.log("Conditions reunies pour call ajax : real_order_id = "+t+" AND timerCount = "+timerCount),setTimeout(getAjaxOrderId,1e4)):console.log("Transaction sent with orderID = "+t))}function getAjaxOrderId(){console.log("getAjaxOrderId");var t=new XMLHttpRequest;t.open("GET",window.location.href),t.setRequestHeader("Content-Type","text/html;charset=UTF-8"),t.send(),t.onreadystatechange=function(){var e;4==t.readyState&&((e=document.createElement("html")).innerHTML=t.responseText,console.log(e.getElementsByClassName("os-order-number")),null!=(e=e.getElementsByClassName("os-order-number")[0].innerHTML.replace("Order #","").replace("Commande #","").trim())?getShopifyCheckout(e):console.log("the orderID is null again"))}}null!=Shopify.checkout&&getShopifyCheckout(null);